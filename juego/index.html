<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Batalla del Conocimiento - Grupos 310 y 316</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.55.2/phaser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.7.18/sweetalert2.all.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #1a1d23 0%, #2d3139 100%);
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        .game-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 15px;
        }

        .header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .header h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 0.9rem;
            margin: 0;
        }

        .quiz-section {
            background: #25282e;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            min-height: 200px;
        }

        .game-section {
            background: #1a1d23;
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .option-btn {
            background: #2d3139;
            border: 2px solid #667eea;
            color: white;
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            text-align: left;
            font-size: 0.85rem;
        }

        .option-btn:hover:not(:disabled) {
            background: #667eea;
            transform: translateX(10px);
        }

        .option-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .option-btn.correct {
            background: #10b981;
            border-color: #10b981;
        }

        .option-btn.incorrect {
            background: #ef4444;
            border-color: #ef4444;
        }

        .health-bar-container {
            position: relative;
            height: 25px;
            background: #1a1d23;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #667eea;
        }

        .health-bar {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.85rem;
        }

        .health-bar.player {
            background: linear-gradient(90deg, #10b981, #34d399);
        }

        .health-bar.enemy {
            background: linear-gradient(90deg, #ef4444, #f87171);
        }

        .score-display {
            background: #2d3139;
            padding: 10px 20px;
            border-radius: 10px;
            text-align: center;
            margin: 10px 0;
        }

        .question-number {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.85rem;
            display: inline-block;
            margin-bottom: 10px;
        }

        #game-canvas {
            border-radius: 10px;
            margin: 0 auto;
            display: block;
        }

        .stats-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .character-name {
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .player-name {
            color: #10b981;
        }

        .enemy-name {
            color: #ef4444;
        }

        .btn-next {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 8px 20px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-next:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-next:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-gamepad"></i> Batalla del Conocimiento</h1>
            <p>Grupos 310 y 316 - Derrota al Tutor Oscuro Fernando</p>
        </div>

        <!-- Stats Row -->
        <div class="stats-row">
            <div style="flex: 1;">
                <div class="character-name player-name">
                    <i class="fas fa-user-graduate"></i> Estudiante
                </div>
                <div class="health-bar-container">
                    <div class="health-bar player" id="playerHealthBar">
                        <span id="playerHealthText">100 / 100</span>
                    </div>
                </div>
            </div>
            
            <div class="score-display mx-3">
                <div style="font-size: 0.9rem; color: #adb5bd;">Pregunta</div>
                <div style="font-size: 1.5rem; font-weight: bold;" id="questionCounter">1 / 20</div>
            </div>
            
            <div style="flex: 1;">
                <div class="character-name enemy-name text-end">
                    Tutor Oscuro Fernando <i class="fas fa-skull"></i>
                </div>
                <div class="health-bar-container">
                    <div class="health-bar enemy" id="enemyHealthBar">
                        <span id="enemyHealthText">100 / 100</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quiz Section -->
        <div class="quiz-section">
            <div class="question-number" id="questionBadge">Pregunta 1</div>
            <h5 id="questionText" style="margin-bottom: 12px; font-size: 1rem;">Cargando pregunta...</h5>
            <div id="optionsContainer"></div>
            <div class="text-end mt-3">
                <button class="btn-next" id="nextBtn" onclick="nextQuestion()" disabled>
                    Siguiente <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- Game Section -->
        <div class="game-section">
            <div id="game-container"></div>
        </div>
    </div>

    <script>
        let currentQuestion = 0;
        let playerHealth = 100;
        let enemyHealth = 100;
        let correctAnswers = 0;
        let game;
        let player;
        let playerSprite;
        let enemySprite;
        let selectedQuestions = [];

        const questionBank = [
            {q: "Â¿CuÃ¡l es el comando de Git para crear una nueva rama?", o: ["git branch nueva-rama", "git create nueva-rama", "git new nueva-rama", "git make nueva-rama"], c: 0},
            {q: "Â¿CÃ³mo se guarda un objeto en localStorage?", o: ["localStorage.save(obj)", "localStorage.setItem('key', JSON.stringify(obj))", "localStorage.put('key', obj)", "localStorage.add(obj)"], c: 1},
            {q: "Â¿QuÃ© mÃ©todo filtra elementos de un array?", o: ["map()", "filter()", "reduce()", "find()"], c: 1},
            {q: "Â¿CuÃ¡ntas columnas tiene Bootstrap?", o: ["10", "12", "16", "8"], c: 1},
            {q: "Â¿QuÃ© hace map() en arrays?", o: ["Filtra", "Transforma cada elemento", "Ordena", "Suma"], c: 1},
            {q: "Â¿MÃ©todo HTTP para actualizar un recurso?", o: ["GET", "POST", "PUT", "PATCH"], c: 2},
            {q: "Â¿QuÃ© hace 'git stash'?", o: ["Elimina cambios", "Guarda cambios temporalmente", "Sube cambios", "Crea rama"], c: 1},
            {q: "Â¿QuÃ© devuelve getItem() si no existe?", o: ["undefined", "null", "''", "false"], c: 1},
            {q: "Â¿Clase Bootstrap para campo invÃ¡lido?", o: ["invalid", "is-invalid", "form-invalid", "error"], c: 1},
            {q: "Â¿MÃ©todo FileReader para Base64?", o: ["readAsText()", "readAsDataURL()", "toBase64()", "convert()"], c: 1},
            {q: "Â¿Breakpoint 'md' en Bootstrap?", o: ["576px", "768px", "992px", "1200px"], c: 1},
            {q: "Â¿sort() sin comparador en nÃºmeros?", o: ["Ordena numÃ©ricamente", "Ordena alfabÃ©ticamente", "Da error", "No hace nada"], c: 1},
            {q: "Â¿Comando Git para ver commits?", o: ["git history", "git log", "git commits", "git show"], c: 1},
            {q: "Â¿Atributo para campo obligatorio?", o: ["mandatory", "required", "must-fill", "obligatory"], c: 1},
            {q: "Â¿Capacidad de localStorage?", o: ["1 MB", "5-10 MB", "50 MB", "Ilimitado"], c: 1},
            {q: "Â¿QuÃ© hace 'git merge'?", o: ["Elimina ramas", "Combina ramas", "Crea ramas", "Lista ramas"], c: 1},
            {q: "Â¿Clase Bootstrap para botÃ³n outline?", o: ["btn-border", "btn-outline-primary", "btn-line", "btn-ghost"], c: 1},
            {q: "Â¿QuÃ© hace reduce()?", o: ["Filtra", "Reduce a un valor", "Ordena", "Multiplica"], c: 1},
            {q: "Â¿HTTP para recurso creado?", o: ["200", "201", "204", "301"], c: 1},
            {q: "Â¿QuÃ© hace 'novalidate'?", o: ["Elimina form", "Deshabilita validaciÃ³n nativa", "Valida auto", "No existe"], c: 1},
            {q: "Â¿Git para descartar cambios?", o: ["git reset", "git discard", "git checkout .", "git clean"], c: 2},
            {q: "Â¿Eliminar item de localStorage?", o: ["delete()", "remove()", "removeItem()", "clear()"], c: 2},
            {q: "Â¿QuÃ© hace forEach()?", o: ["Devuelve array", "Itera sin devolver", "Filtra", "Suma"], c: 1},
            {q: "Â¿Clase Bootstrap para centrar?", o: ["center", "mx-auto", "text-center", "h-center"], c: 1},
            {q: "Â¿MÃ©todo HTTP idempotente?", o: ["POST", "PUT", "PATCH", "Todos"], c: 1},
            {q: "Â¿QuÃ© hace 'git pull'?", o: ["Sube", "Descarga e integra", "Crea rama", "Elimina"], c: 1},
            {q: "Â¿localStorage persiste?", o: ["No", "SÃ­", "Solo incÃ³gnito", "Depende"], c: 1},
            {q: "Â¿QuÃ© hace find()?", o: ["Devuelve todos", "Primer elemento que cumple", "Devuelve Ã­ndice", "Filtra"], c: 1},
            {q: "Â¿Imagen responsive Bootstrap?", o: ["responsive", "img-fluid", "img-responsive", "fluid"], c: 1},
            {q: "Â¿HTTP para 'No encontrado'?", o: ["400", "404", "500", "403"], c: 1},
            {q: "Â¿QuÃ© hace 'git status'?", o: ["Sube", "Muestra estado", "Commit", "Lista ramas"], c: 1},
            {q: "Â¿QuÃ© hace JSON.parse()?", o: ["A string", "String a objeto", "Valida", "Crea JSON"], c: 1},
            {q: "Â¿QuÃ© hace some()?", o: ["Filtra", "Verifica si alguno cumple", "Cuenta", "Suma"], c: 1},
            {q: "Â¿Clase ocultar en Bootstrap?", o: ["hide", "d-none", "invisible", "hidden"], c: 1},
            {q: "Â¿QuÃ© hace DELETE en HTTP?", o: ["Crea", "Actualiza", "Elimina recurso", "Lee"], c: 2},
            {q: "Â¿QuÃ© hace 'git clone'?", o: ["Crea rama", "Descarga repositorio", "Sube", "Backup"], c: 1},
            {q: "Â¿QuÃ© hace clear()?", o: ["Elimina item", "Elimina todo", "Limpia consola", "No existe"], c: 1},
            {q: "Â¿QuÃ© hace every()?", o: ["Devuelve array", "Verifica si todos cumplen", "Filtra", "Cuenta"], c: 1},
            {q: "Â¿Breakpoints Bootstrap 5?", o: ["4", "5", "6", "7"], c: 1},
            {q: "Â¿HTTP para Ã©xito?", o: ["100", "200", "300", "400"], c: 1}
        ];

        function shuffle(arr) {
            const a = [...arr];
            for (let i = a.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
            return a;
        }

        function shuffleQuestion(q) {
            const indices = shuffle([0, 1, 2, 3]);
            return {
                question: q.q,
                options: indices.map(i => q.o[i]),
                correct: indices.indexOf(q.c)
            };
        }

        function selectQuestions() {
            selectedQuestions = shuffle(questionBank).slice(0, 20).map(shuffleQuestion);
        }

        const config = {
            type: Phaser.AUTO,
            width: 850,
            height: 350,
            parent: 'game-container',
            backgroundColor: '#1a1d23',
            scene: {preload, create, update}
        };

        window.onload = function() {
            selectQuestions();
            game = new Phaser.Game(config);
            displayQuestion();
        };

        function preload() {
            this.load.on('loaderror', f => console.log('No cargÃ³:', f.key));
            this.load.image('background', 'images/fondo.png');
            this.load.image('player', 'images/estudiante.png');
            this.load.image('enemy', 'images/tutor.png');
        }

        function create() {
            if (this.textures.exists('background')) {
                const bg = this.add.image(425, 175, 'background');
                bg.setDisplaySize(850, 350);
            } else {
                const g = this.add.graphics();
                g.fillGradientStyle(0x667eea, 0x667eea, 0x764ba2, 0x764ba2, 1);
                g.fillRect(0, 0, 850, 350);
            }

            if (this.textures.exists('player')) {
                playerSprite = this.add.sprite(150, 175, 'player');
                playerSprite.setScale(0.5);
            } else {
                const g = this.add.graphics();
                g.fillStyle(0x10b981, 1);
                g.fillRoundedRect(0, 0, 70, 70, 10);
                g.generateTexture('playerShape', 70, 70);
                playerSprite = this.add.sprite(150, 175, 'playerShape');
                
                const f = this.add.graphics();
                f.fillStyle(0xffffff, 1);
                f.fillCircle(140, 168, 7);
                f.fillCircle(160, 168, 7);
                f.fillStyle(0x000000, 1);
                f.fillCircle(140, 168, 3);
                f.fillCircle(160, 168, 3);
            }

            if (this.textures.exists('enemy')) {
                enemySprite = this.add.sprite(700, 175, 'enemy');
                enemySprite.setScale(0.5);
            } else {
                const g = this.add.graphics();
                g.fillStyle(0xef4444, 1);
                g.fillRoundedRect(0, 0, 70, 70, 10);
                g.generateTexture('enemyShape', 70, 70);
                enemySprite = this.add.sprite(700, 175, 'enemyShape');
                
                const f = this.add.graphics();
                f.fillStyle(0xff0000, 1);
                f.fillCircle(690, 168, 7);
                f.fillCircle(710, 168, 7);
            }

            player = this;
        }

        function update() {}

        function shoot(fx, fy, tx, ty, col) {
            const s = player;
            const g = s.add.graphics();
            g.fillStyle(col, 1);
            g.fillCircle(0, 0, 10);
            g.lineStyle(2, 0xffffff, 0.8);
            g.strokeCircle(0, 0, 10);
            g.generateTexture('proj' + Date.now(), 24, 24);
            
            const p = s.add.sprite(fx, fy, 'proj' + Date.now());
            
            s.tweens.add({
                targets: p,
                x: tx,
                y: ty,
                angle: 360,
                duration: 400,
                ease: 'Power2',
                onComplete: () => {
                    p.destroy();
                    g.destroy();
                }
            });

            s.tweens.add({
                targets: fx < 425 ? playerSprite : enemySprite,
                scaleX: fx < 425 ? 0.6 : 0.4,
                scaleY: fx < 425 ? 0.6 : 0.4,
                duration: 100,
                yoyo: true
            });
        }

        function damage(t) {
            player.tweens.add({
                targets: t,
                alpha: 0.3,
                duration: 100,
                yoyo: true,
                repeat: 2
            });

            player.tweens.add({
                targets: t,
                x: t.x + 10,
                duration: 50,
                yoyo: true,
                repeat: 3
            });
        }

        function displayQuestion() {
            const q = selectedQuestions[currentQuestion];
            document.getElementById('questionBadge').textContent = `Pregunta ${currentQuestion + 1}`;
            document.getElementById('questionCounter').textContent = `${currentQuestion + 1} / 20`;
            document.getElementById('questionText').textContent = q.question;
            
            const c = document.getElementById('optionsContainer');
            c.innerHTML = '';
            
            q.options.forEach((opt, i) => {
                const b = document.createElement('button');
                b.className = 'option-btn';
                b.innerHTML = `<strong>${String.fromCharCode(65 + i)})</strong> ${opt}`;
                b.onclick = () => selectAnswer(i, b);
                c.appendChild(b);
            });
            
            document.getElementById('nextBtn').disabled = true;
        }

        function selectAnswer(idx, btn) {
            const q = selectedQuestions[currentQuestion];
            const ok = idx === q.correct;
            
            document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);
            
            btn.classList.add(ok ? 'correct' : 'incorrect');
            
            if (!ok) {
                document.querySelectorAll('.option-btn')[q.correct].classList.add('correct');
            }
            
            setTimeout(() => {
                if (ok) {
                    correctAnswers++;
                    shoot(150, 175, 700, 175, 0x10b981);
                    setTimeout(() => {
                        enemyHealth -= 5;
                        updateHealth();
                        damage(enemySprite);
                        Swal.fire({icon: 'success', title: 'Â¡Correcto!', text: 'DaÃ±aste al tutor', timer: 1500, showConfirmButton: false});
                    }, 500);
                } else {
                    shoot(700, 175, 150, 175, 0xef4444);
                    setTimeout(() => {
                        playerHealth -= 5;
                        updateHealth();
                        damage(playerSprite);
                        Swal.fire({icon: 'error', title: 'Incorrecto', text: 'El tutor te daÃ±Ã³', timer: 1500, showConfirmButton: false});
                    }, 500);
                }
            }, 500);
            
            document.getElementById('nextBtn').disabled = false;
        }

        function updateHealth() {
            document.getElementById('playerHealthBar').style.width = `${playerHealth}%`;
            document.getElementById('enemyHealthBar').style.width = `${enemyHealth}%`;
            document.getElementById('playerHealthText').textContent = `${playerHealth} / 100`;
            document.getElementById('enemyHealthText').textContent = `${enemyHealth} / 100`;
            
            if (enemyHealth <= 0) setTimeout(endGame, 1000);
        }

        function nextQuestion() {
            currentQuestion++;
            if (currentQuestion < selectedQuestions.length) {
                displayQuestion();
            } else {
                endGame();
            }
        }

        function endGame() {
            const win = enemyHealth <= 0;
            const pct = (correctAnswers / 20) * 100;
            
            if (win) {
                player.tweens.add({
                    targets: enemySprite,
                    alpha: 0,
                    angle: 360,
                    scale: 0,
                    duration: 1000
                });
            }
            
            setTimeout(() => {
                Swal.fire({
                    icon: win ? 'success' : 'info',
                    title: win ? 'Â¡Victoria!' : 'Fin',
                    html: `
                        <h3>${win ? 'Â¡Derrotaste al Tutor Oscuro!' : 'Juego terminado'}</h3>
                        <p><strong>Puntaje:</strong> ${correctAnswers} / 20</p>
                        <p><strong>Porcentaje:</strong> ${pct.toFixed(1)}%</p>
                        <p><strong>Tu salud:</strong> ${playerHealth}</p>
                        <p><strong>Salud enemigo:</strong> ${enemyHealth}</p>
                        ${win ? '<p class="text-success">ðŸŽ‰ Â¡Excelente trabajo!</p>' : ''}
                    `,
                    confirmButtonText: 'Jugar de nuevo',
                    confirmButtonColor: '#667eea'
                }).then(() => location.reload());
            }, 1000);
        }
    </script>
</body>
</html>